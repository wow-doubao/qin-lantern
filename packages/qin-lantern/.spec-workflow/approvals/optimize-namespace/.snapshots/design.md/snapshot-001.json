{
  "id": "snapshot_1768059275740_sqlwtoz0e",
  "approvalId": "approval_1768059275733_0h6uaym8r",
  "approvalTitle": "设计文档：命名空间优化与样式分离 (Design: Optimize Namespace & Style Separation)",
  "version": 1,
  "timestamp": "2026-01-10T15:34:35.740Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# 设计文档：命名空间优化与样式分离\n\n## 1. 系统架构\n本设计不引入新的微服务或数据库，而是对现有的 Vue 3 组件库架构进行重构。核心变更在于引入动态命名空间 Hook (`useNamespace`) 和基于 SCSS 的样式分离架构。\n\n## 2. 详细设计\n\n### 2.1 动态命名空间 (Dynamic Namespace)\n#### 2.1.1 核心逻辑 (`useNamespace` Hook)\n参考 Element Plus 的实现，创建一个 `hooks/use-namespace/index.ts`。\n该 Hook 将提供以下功能：\n- 接收组件名称（block）。\n- 基于全局配置（通过 `provide/inject` 获取）或默认值（`el`，建议修改为 `ql` 作为库的默认值，但需兼容）生成类名生成器。\n- 返回 BEM 辅助函数：`b()`, `e()`, `m()`, `be()`, `em()`, `bm()`, `bem()`, `is()`。\n\n**接口定义**:\n```typescript\nexport const useNamespace = (block: string) => {\n  const namespace = useGlobalConfig('namespace', 'ql'); // 默认 'ql'\n  const b = (blockSuffix = '') => ... // 生成 .ns-block\n  const e = (element?: string) => ... // 生成 .ns-block__element\n  const m = (modifier?: string) => ... // 生成 .ns-block--modifier\n  const is = (name: string, state: boolean | undefined) => ... // 生成 .is-name\n  // ... 其他辅助函数\n  return { namespace, b, e, m, be, em, bm, bem, is };\n};\n```\n\n#### 2.1.2 模板迁移\n所有 `.vue` 文件的 `<template>` 将被更新，移除硬编码的类名字符串，改为绑定 `ns.b()`, `ns.e()` 等。\n\n**示例**:\n```vue\n<!-- Before -->\n<div class=\"el-button\"></div>\n\n<!-- After -->\n<script setup lang=\"ts\">\nimport { useNamespace } from '@qin-lantern/hooks';\nconst ns = useNamespace('button');\n</script>\n<template>\n  <div :class=\"ns.b()\"></div>\n</template>\n```\n\n### 2.2 样式架构 (Style Architecture)\n#### 2.2.1 目录结构\n```\nsrc/\n  styles/\n    index.scss       # 总入口\n    variables.scss   # 变量定义 (消费 Element Plus 变量并定义自己的)\n    mixins/          # BEM mixins\n      mixins.scss\n      var.scss\n  components/\n    button/\n      index.vue\n      style/\n        index.scss   # Button 组件样式\n```\n\n#### 2.2.2 SCSS 变量与 Mixin\n- **变量**: 使用 CSS 变量（CSS Custom Properties）以支持动态主题，同时保留 SCSS 变量用于编译时配置。\n- **Mixin**: 创建 `b`, `e`, `m` 等 SCSS mixin，它们必须利用 `$namespace` 变量（默认为 `ql`，但应可配置）。\n\n**SCSS 示例**:\n```scss\n// src/styles/mixins/mixins.scss\n$namespace: 'ql' !default;\n\n@mixin b($block) {\n  $B: $namespace + '-' + $block !global;\n  .#{$B} {\n    @content;\n  }\n}\n```\n\n### 2.3 Resolver 增强\n修改 `packages/qin-lantern/src/resolver/index.ts`。\n#### 2.3.1 接口扩展\n```typescript\nexport interface QinLanternResolverOptions {\n  /**\n   * import style css or sass with source\n   * @default 'css'\n   */\n  importStyle?: boolean | 'css' | 'sass';\n  \n  /**\n   * custom namespace\n   * @default 'ql'\n   */\n  namespace?: string;\n}\n```\n\n#### 2.3.2 解析逻辑\n- 如果 `importStyle: 'sass'`，侧边效应（sideEffects）应指向 `qin-lantern/es/components/[name]/style/index`（假设构建后结构）。\n- 需确保解析出的组件名称与文件路径匹配。\n\n### 2.4 构建流程 (Build Process)\n#### 2.4.1 Vite 配置\n- 使用 `vite-plugin-static-copy` 或自定义插件，在构建时将 `src/components/**/style/*.scss` 和 `src/styles/**/*.scss` 复制到 `dist` 目录。\n- 确保 `package.json` 的 `exports` 字段暴露这些样式文件。\n\n## 3. 数据库设计\n无（纯前端库）。\n\n## 4. API 设计\n无（不涉及后端 API，仅涉及组件 Props/Slots 变更，暂无破坏性 API 变更）。\n\n## 5. 安全考虑\n无特殊安全风险。\n\n## 6. 第三方库\n- `sass`: 用于样式预处理。\n- `unplugin-vue-components`: 用于测试 Resolver。\n- `element-plus`: 核心依赖，需确保与其样式变量兼容。\n\n## 7. 测试策略\n- **单元测试**: 为 `useNamespace` 编写测试用例，验证不同配置下生成的类名是否正确。\n- **快照测试**: 对关键组件进行快照测试，确保迁移后 DOM 结构（除类名外）保持不变。\n- **集成测试**: 创建一个示例应用，配置自定义 namespace，验证样式是否正确应用且无冲突。\n",
  "fileStats": {
    "size": 4220,
    "lines": 127,
    "lastModified": "2026-01-10T15:34:27.675Z"
  },
  "comments": []
}